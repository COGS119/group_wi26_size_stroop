<!DOCTYPE html>
<html>

<head>
  <title>Stroop Size Task</title>
  <script src="https://unpkg.com/jspsych@8.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-fullscreen@2.1.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>  <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@2.0.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-text@2.1.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@2.0.0"></script>
  <link href="https://unpkg.com/jspsych@8.0.0/css/jspsych.css" rel="stylesheet" type="text/css" />

  <style>
    /* the #jspych...stimulus means that all stimulus for the plugin will be affeced by this
    .cb means that only stuff in the stimulus with the cb class would be affected 
    prevents the normal stimulus from being flipped since it wont have the cb class
    */
   .cb #jspsych-image-keyboard-response-stimulus {
      transform: scaleX(-1); 
      width: 80%;
    }

    .normal #jspsych-image-keyboard-response-stimulus {
      width: 80%;
    }

  </style>
</head>

<body></body>

<script>

 /* initialize jsPsych */
  var jsPsych = initJsPsych(
    {
      on_finish: function() {
        jsPsych.data.displayData();
      }
    }
  );  

  /* create timeline */
  var timeline = [];

  /*create list of congruent and incongruent images */
  var congruent_images = [
  'stimuli/1-Congruent.jpg',
  'stimuli/2-Congruent.jpg',
  'stimuli/3-Congruent.jpg',
  'stimuli/4-Congruent.jpg',
  'stimuli/5-Congruent.jpg',
  'stimuli/6-Congruent.jpg',
  'stimuli/7-Congruent.jpg',
  'stimuli/8-Congruent.jpg',
  'stimuli/9-Congruent.jpg',
  'stimuli/10-Congruent.jpg',
  'stimuli/11-Congruent.jpg',
  'stimuli/12-Congruent.jpg',
  'stimuli/13-Congruent.jpg',
  'stimuli/14-Congruent.jpg',
  'stimuli/15-Congruent.jpg',
  'stimuli/16-Congruent.jpg',
  'stimuli/17-Congruent.jpg',
  'stimuli/18-Congruent.jpg',
  'stimuli/19-Congruent.jpg',
  'stimuli/20-Congruent.jpg',
  'stimuli/21-Congruent.jpg',
  'stimuli/22-Congruent.jpg',
  'stimuli/23-Congruent.jpg',
  'stimuli/24-Congruent.jpg',
  'stimuli/25-Congruent.jpg',
  'stimuli/26-Congruent.jpg',
  'stimuli/27-Congruent.jpg',
  'stimuli/28-Congruent.jpg',
  'stimuli/29-Congruent.jpg',
  'stimuli/30-Congruent.jpg',
  'stimuli/31-Congruent.jpg',
  'stimuli/32-Congruent.jpg',
  'stimuli/33-Congruent.jpg',
  'stimuli/34-Congruent.jpg',
  'stimuli/35-Congruent.jpg',
  'stimuli/36-Congruent.jpg'
  ];

  var incongruent_images = [
  'stimuli/1-Incongruent.jpg',
  'stimuli/2-Incongruent.jpg',
  'stimuli/3-Incongruent.jpg',
  'stimuli/4-Incongruent.jpg',
  'stimuli/5-Incongruent.jpg',
  'stimuli/6-Incongruent.jpg',
  'stimuli/7-Incongruent.jpg',
  'stimuli/8-Incongruent.jpg',
  'stimuli/9-Incongruent.jpg',
  'stimuli/10-Incongruent.jpg',
  'stimuli/11-Incongruent.jpg',
  'stimuli/12-Incongruent.jpg',
  'stimuli/13-Incongruent.jpg',
  'stimuli/14-Incongruent.jpg',
  'stimuli/15-Incongruent.jpg',
  'stimuli/16-Incongruent.jpg',
  'stimuli/17-Incongruent.jpg',
  'stimuli/18-Incongruent.jpg',
  'stimuli/19-Incongruent.jpg',
  'stimuli/20-Incongruent.jpg',
  'stimuli/21-Incongruent.jpg',
  'stimuli/22-Incongruent.jpg',
  'stimuli/23-Incongruent.jpg',
  'stimuli/24-Incongruent.jpg',
  'stimuli/25-Incongruent.jpg',
  'stimuli/26-Incongruent.jpg',
  'stimuli/27-Incongruent.jpg',
  'stimuli/28-Incongruent.jpg',
  'stimuli/29-Incongruent.jpg',
  'stimuli/30-Incongruent.jpg',
  'stimuli/31-Incongruent.jpg',
  'stimuli/32-Incongruent.jpg',
  'stimuli/33-Incongruent.jpg',
  'stimuli/34-Incongruent.jpg',
  'stimuli/35-Incongruent.jpg',
  'stimuli/36-Incongruent.jpg'
  ];

  /*preload*/
  var preload = {
    type: jsPsychPreload,
    images: congruent_images.concat(incongruent_images)
  };

  timeline.push(preload);

  /* create welcome message trial */
  var welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus:`
    <h1>Welcome to the experiment!</h1>
    <p>Press any key to begin</p>
    `
  };

  // timeline.push(welcome);

  // full screen mode ENTER
  var enter_fullscreen = {
    type: jsPsychFullscreen,
    fullscreen_mode: true
  };
  
  // timeline.push(enter_fullscreen);

  //take participant's student ID number
 var participant_id_entry = {
   type: jsPsychSurveyText,
   questions: [
     { prompt: "Please enter your student ID number:", name: "participant_id" }
   ],
   on_finish: function (data) {
    console.log(data.responses);
    jsPsych.data.addProperties({
      participant: data.response.participant_id
    });
   }
 }; 
 
  // timeline.push(participant_id_entry);

  //creates instruction page
  var instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: ` 
      In this experiment, you will be shown two images of real world objects. 
      <br>Your task is to determine which image on the screen is larger or smaller, regardless of the real size of the objects shown.
      <br>You would press <strong>z</strong> to choose the left image, and <strong>m</strong> to choose the right image.
      <br>You would have to complete <strong>3</strong> blocks of trials:
      <br>1. Practice trials so you get familiar with the task
      <br>2. Trials asking to select the larger image
      <br>3. Trials asking to select the smaller image
      <br>
      <br>Before starting, place your <strong>left</strong> index finger on the <strong>z</strong> key and your <strong>right</strong> index finger on the <strong>m</strong> key.
      <br>
      <br>Press any key to begin.
    ` 
  };
  
  // timeline.push(instructions);

  /* creating the stimulus list */
  // 1. adds the proper data each stimulus list 
 var congruent_stimuli = congruent_images.map(function(img) {
    return {
      image_name: img,
      correct_response: "left",   
      correct_response_key: "z",
      trial_type: "congruent",
      css_classes: 'normal' //css_classes is important so the image can get flipped 
    };
  });

 // Incongruent stimuli
 var incongruent_stimuli = incongruent_images.map(function(img) {
    return {
      image_name: img,
      correct_response: "right",  
      correct_response_key: "m",
      trial_type: "incongruent",
      css_classes: 'normal' 
    };
  });

 // 2. Combine both lists
 var stimulus_list = congruent_stimuli.concat(incongruent_stimuli);

 console.log(stimulus_list)
  
 // this is where the stimulus from the list earlier can get flipped
 // cb means counterbalanced
 var cb_stimulus_list = stimulus_list.map (flipped => ( //.map means add stuff, 
      {                                                // ==> works the same as function()
       ...flipped, /*...flipped means it copies everything from stimulus list and then 
       adds the stuff after it*/
       /* changes the name of the trial type, adds _flipped to the end of it */
       trial_type: flipped.trial_type + "_flipped", 
       /* checks if correct response is left, if it is left, 
       changes it to right and vice versa, the ? works as an if else function  */
       correct_response: flipped.correct_response === "left" ? "right" : "left", 
       correct_response_key: flipped.correct_response_key === "z" ? "m" : "z",
       css_classes: 'cb',
      }
    )
  );   

  console.log(cb_stimulus_list);

  //combines counterbalancecd list and stimulus list into one list
  //this exisit so we can take from it randomly 
  var all_stimulus_list = stimulus_list.concat(cb_stimulus_list);

  console.log(all_stimulus_list);

  // creates a new stimulus list by randomly taking x amount from the combined list above
  var test_stimulus_list = jsPsych.randomization.sampleWithoutReplacement(all_stimulus_list, 3);

  console.log(test_stimulus_list);

  // Fixation Cross for practice trials
  var fixation = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: '<div style="font-size:60px;">+</div>',
    choices: "NO_KEYS",
    trial_duration: 700,
  };

  //provides feedback saying if the previous trial is correct or not
  //could maybe add a way to repeat previous trial if incorrect jhere
  var feedback = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus:
      function () {
        var last_trial_correct = jsPsych.data.get().last(1).values()[0].correct;
        if (last_trial_correct) {
          return "<p style='color:green; font-size: 48px;'>Correct!</p>";
        } else {
          return "<p style='color:red; font-size: 48px;'>Incorrect!</p>";
        }
      },
    choices: "NO_KEYS",
    trial_duration: 1000,
  };

  //instructions for SELECTING THE BIGGER IMAGE block 
  var big_instruction = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
      <h1>Which is visually <strong>bigger</strong> on the screen?</h1>
      <br>Press <strong>z</strong> to pick the image on the left, press <strong>m</strong> to pick the image on the right
      <br>Press any key to continue.
    `
  };

   //instructions for SELECTING THE SMALLER IMAGE block
  var small_instruction = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
      <h1>Which is visually <strong>smaller</strong> on the screen?</h1>
      <br>Press <strong>z</strong> to pick the image on the left, press <strong>m</strong> to pick the image on the right
      <br>Press any key to continue.
    `
  };

  //instructions for the PRACTICE TRIALS block
  var practice_instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
      <h1>This is the practice trial section.</h1>
      <br>You will see complete two trials and receive feedback.
      <br>The trials would tell you which image to pick on the bottom of the screen. 
      <br>If you chose wrong, you would need to redo that trial until you get it right.
      <br>Press <strong>z</strong> to pick the image on the left, press <strong>m</strong> to pick the image on the right
      <br>Press any key to continue.
    `
  }

  //instructons for the ACTUAL TRIALS block
  var actual_instructions = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
      <h1>Now you will begin the actual trials.</h1>  
      <p>Press any key to continue.</p>
    `
  };

  //Practice trial ONE (big, congruent)
  var prac_trial_one = {
    type: jsPsychImageKeyboardResponse,
    choices: ["z", "m"],
    stimulus: 'stimuli/1-Congruent.jpg',
    data: {
      trial_type: "congruent",
      correct_response: "left",
      correct_response_key: "z",
    },
    post_trial_gap: 900,
  };

  //push prac trial one to main timeline
  // timeline.push(big_instruction, fixation, prac_trial_one);

  //Practice trial TWO (small, incongruent)
  var prac_trial_two = {
    type: jsPsychImageKeyboardResponse,
    choices: ["z", "m"],
    stimulus: 'stimuli/1-Incongruent.jpg',
    data: {
      trial_type: "incongruent",
      correct_response: "right",
      correct_response_key: "m",
    },
    post_trial_gap: 900,
  };

  //push prac trial two to main timeline
  // timeline.push(small_instruction, fixation, prac_trial_two);

  //this new practice trial, sets the values based on which stimulus is used
  var prac_trial_JW = {
    type: jsPsychImageKeyboardResponse,
    prompt: "<p>Press <strong>z</strong> to choose the left image, <strong>m</strong> to choose the right image.</p>",
    choices: ["z", "m"],
    stimulus: jsPsych.timelineVariable('image_name'),
    data: { 
      trial_type: jsPsych.timelineVariable('trial_type'),
      correct_response: jsPsych.timelineVariable('correct_response'),
      correct_response_key: jsPsych.timelineVariable('correct_response_key'),
      css_classes: jsPsych.timelineVariable('css_classes')
    },
    css_classes: jsPsych.timelineVariable('css_classes'),
    on_finish: function(data) {
      console.log(data.trial_type); //could honestly delete all the console.log 
      console.log(data.response);   //these things are mainly for debugging
      console.log(data.correct_response_key);
      console.log(data.css_classes);
      data.choices = data.response;  
      if (data.choices == data.correct_response_key) {
        data.correct = true;
      } else {
        data.correct = false;
      }
    },
  };

  var prac_looper = {
    timeline: [prac_trial_rep, feedback],
    loop_function: function(data){ //loop_function loops the function, like the name says
      var last_trial = data.values()[0]; //last_trial holds the data from the trial. 
      if (last_trial.correct == false) { //last_trial.correct looks at if correct is true or false
        return true; // because it is == false, if they get it wrong, loop_function will turn on
      } else {
        return false; //if they did it right, no loop
      }
    },
  };

  var prac_trials_test ={
    timeline: [prac_looper],
    timeline_variables: test_stimulus_list, //timeline variable out here so the stimulus doesnt get swapped 
  };

  timeline.push(prac_trials_test)

  // here's how we can construct a simple size stroop judgment trial
  // TO DO: Hm, there's quite a lot of whitespace below the image slide, making the prompt appear far below it. Maybe that could be improved?
  // OTHER TO DOs: what else do we need to add to the trial procedure? What other information should we store? How can we turn this into a complete experiment timeline?
  var test_trials = {
    type: jsPsychImageKeyboardResponse,
    prompt: "<p>Press <strong>z</strong> to choose the left image, <strong>m</strong> to choose the right image.</p>",
    choices: ["z", "m"],
    stimulus: jsPsych.timelineVariable('image_name'),
    data: { 
      trial_type: jsPsych.timelineVariable('trial_type'),
      correct_response: jsPsych.timelineVariable('correct_response'),
      correct_response_key: jsPsych.timelineVariable('correct_response_key'),
      css_classes: jsPsych.timelineVariable('css_classes')
    },
    /* this is where we can add the class to flip the image for counterbalancing.
    The plan is to make it be able to check if the trial is using a flipped imaged or not
    if it uses a cb stimulus, it will be the 'cb' class and the image will be flipped
    otherwise it will be normal and not flipped */
    css_classes: jsPsych.timelineVariable('css_classes'),

    // check to see of the response is correct or not and adds it into the data
    on_finish: function(data) {
      console.log(data.trial_type);
      console.log(data.response);
      console.log(data.correct_response_key);
      console.log(data.css_classes);

      data.choices = data.response;  // Sees if the choice made was correct or incorrect.
      if (data.choices == data.correct_response_key) {
        data.correct = true;
      } else {
        data.correct = false;
      }
    }
  };

  var trial = {
    timeline: [fixation, test_trials, feedback],
    timeline_variables: test_stimulus_list,
  }

  // timeline.push(trial);

  /*goodbye*/
  // may be a fun idea to add a background image here for fun
 var goodbye = {
  type: jsPsychHtmlKeyboardResponse,
  stimulus: "<h1> Thank you for your participation! </h1>",
  trial_duration: 2000, /* without the duration or input, the screen would not change */
 }

 timeline.push(goodbye);

 // full screen mode EXIT
 var exit_fullscreen = {
    type: jsPsychFullscreen,
    fullscreen_mode: false,
    delay_after: 0
  }

  // timeline.push(exit_fullscreen)

  /* start the experiment */
  jsPsych.run(timeline);
  
</script>

</html>